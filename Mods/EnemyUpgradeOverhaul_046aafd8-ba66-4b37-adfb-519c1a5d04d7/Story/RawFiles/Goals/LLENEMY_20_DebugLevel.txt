Version 1
SubGoalCombiner SGC_AND
INITSECTION
KBSECTION

IF
GameModeStarted(_,0)
THEN
GoalCompleted;

IF
GameStarted(_,0)
THEN
GoalCompleted;

IF
RegionStarted("TestLevel_LL_LeaderLib")
THEN
GlobalClearFlag("LLENEMY_DuplicationUpgradesDisabled");

IF
RegionStarted("_TMPL_Sandbox")
THEN
GlobalClearFlag("LLENEMY_DuplicationUpgradesDisabled");

IF
TextEventSet("llenemy_applystats")
THEN
LeaderLog_Log("TRACE", "[LLENEMY_20_DebugLevel:llenemy_applystats] Testing stats applying.");

IF
TextEventSet("llenemy_applystats")
AND
CharacterGetHostCharacter(_Player)
AND
LeaderLib_Recon_QRY_GetString("llenemy_applystats", "stats", 1, "Summon_Ice_Elemental")
AND
DB_LeaderLib_Recon_Temp_CommandParameters_String("llenemy_applystats", "stats", _Stats, _NextParamIndex)
AND
LeaderLib_Recon_QRY_GetUUID("llenemy_applystats", "target", _NextParamIndex, _Player)
AND
DB_LeaderLib_Recon_Temp_CommandParameters_UUID("llenemy_applystats", "target", _Target, _NextParamIndex2)
AND
String(_Target, _CharStr)
THEN
/* [OSITOOLS_ONLY]
NRD_LuaCall("LLENEMY_Ext_TraceCharacterStats", _CharStr);
*/
SetVarFixedString(_Target, "LLENEMY_ApplyStats_Stats", _Stats);
SetStoryEvent(_Target, "LLENEMY_ApplyStats");

IF
TextEventSet("llenemy_applystats")
THEN
LeaderLib_Recon_ClearParams("llenemy_applystats");

/* [OSITOOLS_ONLY]
IF
StoryEvent((CHARACTERGUID)_Char, "LLENEMY_ApplyStats_Done")
AND
String(_Char, _CharStr)
THEN
NRD_LuaCall("LLENEMY_Ext_TraceCharacterStats", _CharStr);
*/

//REGION CP_DEBUG
PROC
LLENEMY_Upgrades_OnRollingDone((CHARACTERGUID)_Char)
AND
GetVarInteger(_Char, "LLENEMY_ChallengePoints", _ChallengePoints)
AND
_ChallengePoints > 0
AND
IntegertoString(_ChallengePoints, _PointsStr)
AND
CharacterGetDisplayName(_Char, _, _Name)
THEN
LeaderLog_Log("TRACE", "[LLENEMY:Upgrades:OnRollingDone] Enemy [",_Name,"] Challenge Points value is [",_PointsStr,"].");

IF
CharacterDied(_Char)
AND
GetVarInteger(_Char, "LLENEMY_ChallengePoints", _ChallengePoints)
AND
_ChallengePoints > 0
AND
IntegertoString(_ChallengePoints, _PointsStr)
AND
CharacterGetDisplayName(_Char, _, _Name)
THEN
LeaderLog_Log("TRACE", "[LLENEMY:Rewards:Debug] Enemy [",_Name,"] died. Challenge Points [",_PointsStr,"].");
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "LaughingLeader_EnemyUpgradeOverhaul"